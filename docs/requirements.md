# CSV Light Editor - 要件定義書

## プロジェクト概要

### 目的
Mac用の高速かつ軽量なCSV編集アプリケーションの開発

### 技術スタック
- **バックエンド**: Rust + Tauri
- **フロントエンド**: React + TypeScript
- **配布形式**: スタンドアロン.appファイル（App Store経由なし）

### 主要目標
1. 大容量CSVファイル（100万行以上）の高速処理
2. 直感的なスプレッドシート風UI
3. メモリ効率的なストリーミング処理
4. AI支援によるデータ操作機能

## 機能要件

### 1. ファイル処理

#### 1.1 基本機能
- CSVファイルの読み込み・編集・保存
- 元のCSV形式を保持（エンコーディング、区切り文字、改行コード）
- プログレッシブローディング（大容量ファイル対応）

#### 1.2 メタデータ管理
- 列幅、フィルター、計算式などの設定を.csvmetaファイルで保存
- CSVファイルと同じディレクトリに自動生成
- メタデータ構造:
  ```json
  {
    "version": "1.0.0",
    "csvPath": "data.csv",
    "encoding": "UTF-8",
    "delimiter": ",",
    "columns": {
      "0": {
        "width": 120,
        "type": "string",
        "visible": true,
        "name": "Column A"
      }
    },
    "filters": [],
    "calculations": {},
    "viewState": {
      "sortColumn": null,
      "sortOrder": "asc",
      "frozenColumns": 0,
      "frozenRows": 0
    }
  }
  ```

### 2. 編集機能

#### 2.1 基本編集
- セル単位での編集（ダブルクリックまたはF2キー）
- 複数セル選択とバルク編集
- 行・列の追加、削除、移動
- Undo/Redo機能（Cmd+Z/Cmd+Shift+Z）
- コピー＆ペースト（Cmd+C/Cmd+V）

#### 2.2 データ操作
- **ソート**: 単一列/複数列、昇順/降順
- **フィルタリング**: 
  - テキストフィルター（含む、含まない、等しい、正規表現）
  - 数値フィルター（より大きい、より小さい、範囲）
  - 日付フィルター
- **検索・置換**: 
  - 大文字小文字の区別
  - 正規表現サポート
  - 選択範囲内のみ

#### 2.3 データ型と検証
- 自動データ型判定（文字列、数値、日付、ブール値）
- カスタムフォーマット設定
- リアルタイムバリデーション
- エラーハイライト表示

### 3. 計算機能

#### 3.1 統計計算
- 基本統計: SUM, AVERAGE, COUNT, MIN, MAX
- 高度な統計: MEDIAN, MODE, STDEV, VAR
- パーセンタイル計算

#### 3.2 計算式
- Excel互換の関数構文
- セル参照（A1形式）
- 範囲参照（A1:B10）
- 計算結果の新規列への挿入
- リアルタイム再計算

#### 3.3 行間計算
- 前行との差分
- 累積値
- 移動平均
- 成長率・変化率

### 4. AI機能

#### 4.1 データクリーニング
- 重複行の検出と削除
- 異常値の検出とハイライト
- データ形式の統一化（日付、電話番号など）
- 欠損値の処理提案

#### 4.2 データ補完
- 空白セルの予測補完
- パターン認識による自動入力
- カテゴリ推定

#### 4.3 自然言語インターフェース
- 自然言語でのデータ操作
  - 例: "売上が100万円以上の行を抽出"
  - 例: "日付列を年月日形式に変換"
- データ変換提案
- 分析レポート生成

### 5. エクスポート機能

#### 5.1 形式変換
- **Markdown table**: クリップボードへのコピー
- **JSON**: 配列形式/オブジェクト形式の選択
- **Excel**: .xlsx形式（オプション）
- **TSV**: タブ区切り

#### 5.2 エンコーディング
- UTF-8（デフォルト）
- Shift_JIS
- EUC-JP
- BOM付き/なし選択

#### 5.3 カスタマイズ
- 区切り文字の変更
- 改行コードの選択（LF/CRLF）
- ヘッダー行の有無
- クォート文字の設定

## 非機能要件

### パフォーマンス要件
| ファイルサイズ | 読み込み時間 | 操作レスポンス |
|--------------|------------|--------------|
| ～1MB | < 1秒 | リアルタイム |
| ～10MB | < 3秒 | < 100ms |
| ～100MB | < 10秒 | < 200ms |
| 100MB～ | プログレッシブ | < 500ms |

### システム要件
- **OS**: macOS 11.0 以降
- **メモリ**: 最小4GB、推奨8GB以上
- **ディスク**: アプリ本体50MB + 作業領域
- **プロセッサ**: Apple Silicon対応（Universal Binary）

### セキュリティ要件
- ローカルファイルアクセスのみ（ネットワーク通信は更新チェックのみ）
- サンドボックス環境での実行
- 機密データの暗号化保存（オプション）

### ユーザビリティ要件
- Numbersライクな直感的操作
- ダークモード対応
- キーボードショートカット完備
- 多言語対応（日本語、英語）

## 制約事項

### 技術的制約
- App Store経由での配布なし（コード署名なし）
- ローカル実行のみ（クラウド連携なし）
- AI機能はローカルモデル優先

### ビジネス制約
- 個人用途向け（エンタープライズ機能なし）
- 無料配布（ライセンス管理なし）

## 品質基準

### テスト要件
- 単体テストカバレッジ: 80%以上
- E2Eテスト: 主要ユースケース網羅
- パフォーマンステスト: 各種サイズでのベンチマーク
- ユーザビリティテスト: 5名以上のテストユーザー

### 受け入れ基準
1. 100万行のCSVを10秒以内に開ける
2. スクロール時のフレームレート60fps維持
3. メモリ使用量がファイルサイズの2倍以内
4. クラッシュ率0.1%以下

## リスクと対策

### 技術的リスク
| リスク | 影響度 | 対策 |
|-------|-------|------|
| 大容量ファイル処理でのメモリ不足 | 高 | ストリーミング処理、仮想スクロール |
| AI機能の精度不足 | 中 | 段階的リリース、フィードバック収集 |
| Tauri v2の安定性 | 低 | 定期的な依存関係更新 |

### プロジェクトリスク
| リスク | 影響度 | 対策 |
|-------|-------|------|
| スコープクリープ | 中 | MVP定義、段階的機能追加 |
| パフォーマンス目標未達 | 高 | 早期プロトタイプ、継続的計測 |

## 今後の拡張可能性

### Phase 2（将来的な機能）
- グラフ・チャート生成
- ピボットテーブル
- マクロ・スクリプト機能
- プラグインシステム
- クラウド同期（オプション）
- Windows/Linux対応

### Phase 3（長期的な展望）
- チーム協業機能
- バージョン管理
- API連携
- BI機能統合