# Quickstart Guide: AIチャット機能（スクリプト生成・実行型）

**Date**: 2025-01-27  
**Feature**: AIチャット機能（スクリプト生成・実行型）  
**Plan Reference**: [plan.md](./plan.md)

## Overview

このクイックスタートガイドは、AIチャット機能の主要なユースケースを検証するための手順を提供します。各シナリオは、仕様書のAcceptance Scenariosに対応しています。

---

## Prerequisites

1. CSVファイルが開かれていること
2. AI機能が有効になっていること（環境変数設定済み）
3. Python 3.9+ がインストールされていること

---

## Scenario 1: 分析型スクリプトの実行（承認不要）

### Steps

1. CSVファイルを開く
2. チャットパネルで「売上の平均値を計算して」と入力
3. 送信ボタンをクリック

### Expected Results

- スクリプトが生成される（数秒以内）
- スクリプトが自動的に実行される（承認不要）
- 分析結果がチャットに表示される
- チャット履歴にメッセージが追加される

### Validation

- [ ] スクリプトが3秒以内に生成される
- [ ] 分析結果が正しく表示される
- [ ] チャット履歴に保存される
- [ ] エラーが発生しない

---

## Scenario 2: 変更型スクリプトの承認フロー

### Steps

1. CSVファイルを開く
2. チャットパネルで「日付列を年月日形式に変換して」と入力
3. 送信ボタンをクリック
4. 生成されたスクリプトのプレビューを確認
5. 「承認」ボタンをクリック

### Expected Results

- スクリプトが生成される
- 変更内容のプレビューが表示される
- 承認後にスクリプトが実行される
- CSVファイルの内容が変更される
- 変更がUndo可能である

### Validation

- [ ] プレビューが正しく表示される
- [ ] 承認後にスクリプトが実行される
- [ ] CSVファイルが正しく変更される
- [ ] Cmd+ZでUndoできる
- [ ] チャット履歴に承認状態が保存される

---

## Scenario 3: スクリプトの編集と再生成

### Steps

1. CSVファイルを開く
2. チャットパネルで「価格列を10%増やして」と入力
3. 生成されたスクリプトを確認
4. スクリプトの内容を編集
5. 「再生成」ボタンをクリック
6. 新しいプレビューを確認
7. 「承認」ボタンをクリック

### Expected Results

- 編集後のスクリプトが再生成される
- 新しいプレビューが表示される
- 承認後に実行される

### Validation

- [ ] スクリプトが正しく編集できる
- [ ] 再生成が正常に動作する
- [ ] 新しいプレビューが表示される

---

## Scenario 4: エラーハンドリング

### Steps

1. CSVファイルを開く
2. チャットパネルで「存在しない列を操作する」ような指示を入力
3. 送信ボタンをクリック

### Expected Results

- エラーメッセージが表示される
- エラーの原因が明確に示される
- ユーザーが修正できる

### Validation

- [ ] エラーメッセージが表示される
- [ ] エラーの原因が理解できる
- [ ] ユーザーが修正できる

---

## Scenario 5: 進捗表示

### Steps

1. 大きなCSVファイル（10,000行以上）を開く
2. チャットパネルで「すべての行を処理する」ような時間のかかる操作を指示
3. 送信ボタンをクリック
4. スクリプトを承認

### Expected Results

- 進捗バーが表示される
- 処理済み行数が更新される
- 現在のステップが表示される
- 進捗率が更新される

### Validation

- [ ] 進捗バーが表示される
- [ ] 進捗情報がリアルタイムで更新される
- [ ] 処理が完了するまで進捗が表示される

---

## Scenario 6: チャット履歴の永続化

### Steps

1. CSVファイルを開く
2. 複数のチャット操作を実行
3. CSVファイルを閉じる
4. 同じCSVファイルを再度開く

### Expected Results

- チャット履歴が復元される
- 過去の操作が確認できる
- スクリプトの内容が表示される

### Validation

- [ ] チャット履歴が正しく復元される
- [ ] 過去のメッセージが表示される
- [ ] スクリプトの内容が確認できる

---

## Scenario 7: Undo/Redo機能

### Steps

1. CSVファイルを開く
2. 変更型スクリプトを実行
3. Cmd+Z（Undo）を実行
4. Cmd+Shift+Z（Redo）を実行

### Expected Results

- Undoで変更が取り消される
- Redoで変更が再度適用される
- 通常の編集操作と同じUndo/Redo履歴に統合される

### Validation

- [ ] Undoが正常に動作する
- [ ] Redoが正常に動作する
- [ ] 通常の編集操作と統合されている

---

## Scenario 8: セキュリティ検証

### Steps

1. CSVファイルを開く
2. チャットパネルで危険な操作（ファイルシステムアクセスなど）を含む指示を入力
3. 送信ボタンをクリック

### Expected Results

- セキュリティ検証が実行される
- 危険な操作が検出される
- エラーメッセージが表示される
- スクリプトが実行されない

### Validation

- [ ] セキュリティ検証が動作する
- [ ] 危険な操作が検出される
- [ ] スクリプトが実行されない

---

## Integration Test Checklist

各シナリオを実装後に、以下の統合テストを実行：

- [ ] Scenario 1: 分析型スクリプトの実行
- [ ] Scenario 2: 変更型スクリプトの承認フロー
- [ ] Scenario 3: スクリプトの編集と再生成
- [ ] Scenario 4: エラーハンドリング
- [ ] Scenario 5: 進捗表示
- [ ] Scenario 6: チャット履歴の永続化
- [ ] Scenario 7: Undo/Redo機能
- [ ] Scenario 8: セキュリティ検証

---

## Performance Benchmarks

実装後に以下のパフォーマンスを測定：

- スクリプト生成時間: < 3秒（目標）
- 進捗更新の頻度: 1秒以内
- チャット履歴の読み込み: < 500ms
- チャット履歴の保存: < 500ms

---

## Troubleshooting

### スクリプトが生成されない

- AI機能が有効か確認
- 環境変数が正しく設定されているか確認
- ネットワーク接続を確認（API使用時）

### スクリプトが実行されない

- Python 3.9+ がインストールされているか確認
- Pythonのパスが正しく設定されているか確認
- セキュリティ検証でブロックされていないか確認

### 進捗が表示されない

- スクリプトが進捗情報を出力しているか確認
- Tauriイベントが正しく送信されているか確認
- フロントエンドのイベントリスナーが設定されているか確認

---

*Quickstart guide created: 2025-01-27*

